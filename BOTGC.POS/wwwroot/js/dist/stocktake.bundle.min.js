(()=>{"use strict";const t="wastage_operator_id",e="wastage_operator_ts";let n=!1;const o={"WINES|BOTTLE":["CountInStoreRoom","CountInLoungeBar","OpenBottleWeightGrams@Lounge","CountInColtBar","OpenBottleWeightGrams@Colt"],"FORTIFIED WINES|BOTTLE":["CountInStoreRoom","CountInLoungeBar","OpenBottleWeightGrams@Lounge","CountInColtBar","OpenBottleWeightGrams@Colt"],"MINERALS|BOTTLE":["CountInStoreRoom","CountInLoungeBar","CountInColtBar"],"SNACKS|EACH":["CountInStoreRoom","CountInLoungeBar","CountInColtBar"],"BEER CANS|CAN":["CountInStoreRoom","CountInLoungeBar","CountInColtBar"],"BOTTLED BEER|BOTTLE":["CountInStoreRoom","CountInLoungeBar","CountInColtBar"],"DRAUGHT BEER|PINT":["CountInCellar","KegWeightGrams@Cellar"],"SPIRITS|BOTTLE":["CountInStoreRoom","CountInLoungeBar","OpenBottleWeightGrams@Lounge","CountInColtBar","OpenBottleWeightGrams@Colt"],"MEAT & POULTRY|*":["CountInStoreRoom","CountInKitchen"],"FISH|*":["CountInStoreRoom","CountInKitchen"],"DAIRY|*":["CountInStoreRoom","CountInKitchen"],"BAKERY|*":["CountInStoreRoom","CountInKitchen"],"DESSERTS & ICE CREAM|*":["CountInStoreRoom","CountInKitchen"],"FRUIT & VEG|*":["CountInStoreRoom","CountInKitchen"],"SAUCES|*":["CountInStoreRoom","CountInKitchen"],"DRY GOODS|*":["CountInStoreRoom","CountInKitchen"],"PREPARED MEALS|*":["CountInStoreRoom","CountInKitchen"],"HOT DRINKS|*":["CountInStoreRoom","CountInKitchen"],"PANTRY|EACH":["CountInStoreRoom","CountInKitchen"],"PANTRY|BOTTLE":["CountInStoreRoom","CountInKitchen"],"PANTRY|*":["CountInStoreRoom","CountInKitchen"],"*|*":["CountInStoreRoom","CountInLoungeBar","CountInColtBar"]},a=new Set(["WINES","MINERALS","SNACKS","BEER CANS","BOTTLED BEER","DRAUGHT BEER","FORTIFIED WINES"].map(t=>t.toUpperCase())),i=new Set(["WINES","FORTIFIED WINES","SPIRITS"]);function s(t){const e=parseInt(t??"",10);return Number.isFinite(e)&&e>0?e:null}function r(t,e,n,o){const a=S(`stocktake:${(new Date).toISOString().slice(0,10)}:${o}`),i=E(t.filter(t=>e(t)).filter(t=>Array.isArray(t.products)&&t.products.length>0),a);return i.slice(0,Math.min(n,i.length))}function c(t){return a.has(String(t.division||"").toUpperCase())}function l(t){return!c(t)}function u(t,e){const n=String(t||"").toUpperCase(),a=String(e||"").toUpperCase(),i=o[`${n}|${a}`];if(i)return i;const s=o[`${n}|*`];if(s)return s;const r=o[`*|${a}`];return r||o["*|*"]}function d(t){const[e,n]=String(t).split("@");return{code:e,location:n||null}}function m(t){const e=("; "+document.cookie).split("; "+t+"=");return 2===e.length?e.pop().split(";").shift():null}function p(t,e,n){let o="";if("number"==typeof n){const t=new Date;t.setTime(t.getTime()+24*n*60*60*1e3),o="; expires="+t.toUTCString()}document.cookie=`${t}=${e}; path=/; SameSite=Lax${o}`}function g(t){document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; SameSite=Lax`}function C(){return Date.now()}function I(){p(e,String(C()),365)}function b(){const t=parseInt(m(e)||"0",10);return!t||C()-t>9e5}function h(t){return String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function f(t){return String(t||"").toLowerCase().normalize("NFKD").replace(/&/g," ").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function v(t){const e=new URL(window.location.href).searchParams.get(t);return null===e?null:e}function S(t){const e=function(t){let e=1779033703^t.length;for(let n=0;n<t.length;n++)e=Math.imul(e^t.charCodeAt(n),3432918353),e=e<<13|e>>>19;return function(){return e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),e^=e>>>16,e>>>0}}(t);return n=e(),o=e(),a=e(),i=e(),function(){let t=(n>>>=0)+(o>>>=0)|0;return n=o^o>>>9,o=(a>>>=0)+(a<<3)|0,t=t+(i=(i>>>=0)+1|0)|0,a=(a=a<<21|a>>>11)+t|0,(t>>>0)/4294967296};var n,o,a,i}function E(t,e){const n=t.slice();for(let t=n.length-1;t>0;t--){const o=Math.floor(e()*(t+1));[n[t],n[o]]=[n[o],n[t]]}return n}let y=[],B=null;const $=new Map,k=new Map;let L=null;function T(){const n=m(t),o=document.getElementById("operatorStatus");if(!n)return o.innerHTML='<span class="muted">No operator selected.</span>',void R();const a=document.querySelector(`#operatorTiles .tile[data-opid='${n}']`);if(!a)return g(t),g(e),o.innerHTML='<span class="muted">No operator selected.</span>',void R();const i=a.dataset.color||"#cccccc";o.innerHTML=`<div class="tile tile--op" style="background:${i};"><span class="tile__name">${h(a.textContent.trim())}</span></div>`,o.querySelector(".tile--op").addEventListener("click",R)}function R(){const t=document.getElementById("operatorModal");t.addEventListener("cancel",t=>t.preventDefault(),{once:!0}),t.showModal()}async function w(t){const e=await fetch((n=t,`/stocktake/draft?division=${encodeURIComponent(n)}`));var n;if(!e.ok)return $.clear(),[];const o=await e.json(),a=Array.isArray(o)?o:Object.values(o??{});$.clear(),k.clear();for(const t of a){const e=t.stockItemId??t.StockItemId,n=t.calibration??t.Calibration??null;n&&k.set(e,{nominalVolumeMl:n.nominalVolumeMl??n.NominalVolumeMl,emptyWeightGrams:n.emptyWeightGrams??n.EmptyWeightGrams,fullWeightGrams:n.fullWeightGrams??n.FullWeightGrams,confidence:n.confidence??n.Confidence,strategy:n.strategy??n.Strategy});const o=t.observations??t.Observations??[];o.length>0&&$.set(e,{stockItemId:e,name:t.name??t.Name,division:t.division??t.Division,unit:t.unit??t.Unit,operatorId:t.operatorId??t.OperatorId,operatorName:t.operatorName??t.OperatorName,at:t.at??t.At,observations:o,estimatedQuantityAtCapture:t.estimatedQuantityAtCapture??t.EstimatedQuantityAtCapture??null})}return a}function N(t){if(!t?.length)return null;const e=t.map(t=>t.daysSinceLastStockTake).filter(t=>Number.isFinite(t));if(0===e.length)return null;const n=e.reduce((t,e)=>t+e,0);return Math.round(n/e.length)}function A(t){const e=String(t||"").trim().toLowerCase();return e?"bottle"===e?"bottles":"can"===e?"cans":"each"===e?"items":"pint"===e?"pints":e.endsWith("s")?e:e+"s":"items"}async function M(t){const e=await w(t.division);let n=[];n=e.length>0?e.map(e=>({stockItemId:e.stockItemId??e.StockItemId,name:e.name??e.Name,unit:e.unit??e.Unit,division:t.division,currentQuantity:e.estimatedQuantityAtCapture??e.EstimatedQuantityAtCapture??null})):(t.products||[]).map(e=>({stockItemId:e.stockItemId??e.StockItemId,name:e.name??e.Name,unit:e.unit??e.Unit,division:t.division,currentQuantity:e.currentQuantity??e.CurrentQuantity??null})),B={...t,products:n},document.getElementById("divisionTitle").textContent=t.division,function(){const t=document.getElementById("productTiles");t.innerHTML="";const e=B?.division||"",n=B?.products||[];for(const o of n){const n=$.get(o.stockItemId),a=document.createElement("div");a.className="tile",a.dataset.stockItemId=o.stockItemId,a.dataset.name=o.name||"",a.dataset.unit=o.unit||"",a.dataset.division=e,a.dataset.estimate=o.currentQuantity??"";const s="BOTTLE"===String(o.unit||"").toUpperCase(),r=i.has(String(e||"").toUpperCase()),c=k.get(o.stockItemId);s&&r&&(!c||!(c.confidence>=.95))&&a.classList.add("tile--uncertain"),a.innerHTML=`<div class="tile__name">${h(o.name)}</div>\n                          <small class="tile__division">${h(o.unit||"")}</small>`,a.addEventListener("click",()=>K(o.stockItemId,o.name,e,o.unit)),t.appendChild(a),n&&_(o.stockItemId,n)}}(),function(){document.getElementById("obsTbody").innerHTML="";for(const[,t]of $)q(t.stockItemId)}(),document.getElementById("productsSection").hidden=!1,document.getElementById("observationsSection").hidden=0===$.size}function O(t){return Array.from(document.querySelectorAll(".tiles--products .tile")).find(e=>parseInt(e.dataset.stockItemId,10)===t)||null}function W(t){const e=u(t.division,t.unit).map(t=>d(t)),n=new Set((t.observations||[]).map(t=>`${t.code}@${t.location||""}`));let o=0;for(const t of e){const e=`${t.code}@${t.location||""}`;(t.code.startsWith("CountIn")?Array.from(n).some(e=>e.startsWith(`${t.code}@`)):n.has(e))||o++}return o}function _(t,e){const n=O(t);if(!n)return;n.classList.remove("tile--partial","tile--complete"),n.querySelector(".tile__badge")?.remove();if(!((e.observations||[]).length>0))return;const o=W(e);if(0===o)n.classList.add("tile--complete");else{n.classList.add("tile--partial");const t=document.createElement("span");t.className="tile__badge",t.textContent=`${o} left`,n.appendChild(t)}}function K(o,a,s,r){const c=document.getElementById("obsModal"),l=document.getElementById("obsTitle"),d=document.getElementById("obsFields");l.textContent=`Record observations: ${a}`;const p=function(t){return(B?.products||[]).find(e=>e.stockItemId===t)||null}(o),C=p?.currentQuantity??null,I=$.get(o)?.observations||[],f=u(s,r),v=function(t){return k.get(t)||null}(o),S="BOTTLE"===String(r||"").toUpperCase(),E=i.has(String(s||"").toUpperCase()),y=S&&E&&(!v||!(v.confidence>=.95));!function(t,e,o,a,s,r={needsBottleCalibration:!1,calibration:null,name:""}){t.innerHTML="";const{needsBottleCalibration:c,calibration:l,name:u}=r;if(c){const e=document.createElement("div");e.className="obs-estimate";const n=l?`(${Math.round(100*(l.confidence??0))}% match)`:"(no match yet)";e.textContent=`Bottle details unconfirmed ${n}. Please weigh a full and/or an empty bottle if available.`,t.appendChild(e)}if(n&&null!=s&&isFinite(s)){const e=document.createElement("div");e.className="obs-estimate",e.textContent=`Current estimated stock: ${s} ${A(a)}`,t.appendChild(e)}const d=document.createElement("div");d.className="obs-progress",t.appendChild(d);const m=document.createElement("div");m.className="obs-hint",m.textContent="Blank = not observed. 0 = none found.",t.appendChild(m);const p=document.createElement("div");p.className="obs-groups",t.appendChild(p);const g=new Map;(o||[]).forEach(t=>{const e=`${t.code}@${t.location||""}`;g.set(e,t.value)});const C=A(a);function I(t,e,n){const[o,a]=String(t).split("@"),i=a||null,s=o.startsWith("CountIn")&&n.isOpenableBottle?`Number of unopened ${e}`:"Count";return"CountInStoreRoom"===o?{group:"Store Room",label:s,code:o,location:"Store"}:"CountInColtBar"===o?{group:"Colt bar",label:s,code:o,location:"Colt"}:"CountInLoungeBar"===o?{group:"Lounge bar",label:s,code:o,location:"Lounge"}:"CountInCellar"===o?{group:"Cellar",label:"Count",code:o,location:"Cellar"}:"OpenBottleWeightGrams"===o&&"Colt"===i?{group:"Colt bar",label:"Total weight of open bottles (g)",code:o,location:"Colt"}:"OpenBottleWeightGrams"===o&&"Lounge"===i?{group:"Lounge bar",label:"Total weight of open bottles (g)",code:o,location:"Lounge"}:"KegWeightGrams"===o&&"Cellar"===i?{group:"Cellar",label:"Weight of Keg being used (g)",code:o,location:"Cellar"}:"CountInKitchen"===o?{group:"Kitchen",label:s,code:o,location:"Kitchen"}:{group:"Other",label:o+(i?` (${i})`:""),code:o,location:i}}const b={isOpenableBottle:"BOTTLE"===String(a||"").toUpperCase()&&i.has(String(B?.division||"").toUpperCase())},f=["Store Room","Kitchen","Colt bar","Lounge bar","Cellar","Other"],v=new Map(f.map(t=>[t,[]]));for(const t of e){const e=I(t,C,b);v.get(e.group).push(e)}for(const t of f){const e=v.get(t)||[];if(!e.length)continue;const n=document.createElement("section");n.className="obs-group";const o=document.createElement("h4");o.className="obs-group__title",o.textContent=t,n.appendChild(o);const a=document.createElement("div");a.className="obs-row",n.appendChild(a);for(const t of e){const e=`${t.code}@${t.location||""}`,n=g.has(e)?g.get(e):"",o=document.createElement("div");o.className="obs-field",o.innerHTML=`<label class="obs-label">${h(t.label)}</label>\n                    <div class="obs-input-row">\n                        <input type="number" step="1" min="0"\n                            class="obs-input"\n                            data-code="${h(t.code)}"\n                            ${t.location?`data-location="${h(t.location)}"`:""}\n                            value="${""!==n?String(n):""}">\n                        <button type="button" class="btn-quick-zero" data-for="${h(e)}" aria-label="Set to none">None</button>\n                    </div>`,a.appendChild(o)}p.appendChild(n)}if(c){const t=document.createElement("section");t.className="obs-group";const e=document.createElement("h4");e.className="obs-group__title",e.textContent="Bottle calibration (optional)",t.appendChild(e);const n=document.createElement("div");n.className="obs-row",t.appendChild(n);const o=document.createElement("div");o.className="obs-field",o.innerHTML='<label class="obs-label">Weight of full bottle (g)</label>\n                 <div class="obs-input-row">\n                    <input type="number" step="1" min="0" class="obs-input"\n                           data-code="FullBottleWeightGrams" value="">\n                    <button type="button" class="btn-quick-zero" data-for="FullBottleWeightGrams@" aria-label="Clear">Clear</button>\n                 </div>',n.appendChild(o);const a=document.createElement("div");a.className="obs-field",a.innerHTML='<label class="obs-label">Weight of empty bottle (g)</label>\n                 <div class="obs-input-row">\n                    <input type="number" step="1" min="0" class="obs-input"\n                           data-code="EmptyBottleWeightGrams" value="">\n                    <button type="button" class="btn-quick-zero" data-for="EmptyBottleWeightGrams@" aria-label="Clear">Clear</button>\n                 </div>',n.appendChild(a),p.appendChild(t)}const S=document.createElement("div");S.className="obs-note",S.textContent="You can record some values now and come back later to complete this product. Observations should be completed before the end of the day.";const E=document.querySelector("#obsModal footer.actions");E.classList.add("obs-footer"),E.querySelector(".obs-note")?.remove();let y=E.querySelector(".obs-btns");if(!y){const t=document.getElementById("obsSaveBtn"),e=document.getElementById("obsCancelBtn");y=document.createElement("div"),y.className="obs-btns",E.appendChild(y),y.appendChild(t),y.appendChild(e)}function $(){const e=Array.from(t.querySelectorAll("input[data-code]")),n=e.length,o=e.filter(t=>""!==t.value).length,a=o===n;d.textContent=`${o} of ${n} observations recorded${a?" — Complete":""}`}E.prepend(S),t.addEventListener("input",t=>{t.target&&t.target.matches("input[data-code]")&&$()}),t.addEventListener("click",e=>{const n=e.target.closest(".btn-quick-zero");if(!n)return;const o=n.dataset.for,a=Array.from(t.querySelectorAll("input[data-code]")).find(t=>`${t.getAttribute("data-code")}@${t.getAttribute("data-location")||""}`===o);a&&(a.value="0",a.dispatchEvent(new Event("input",{bubbles:!0})),a.focus(),a.select())}),$()}(d,f,I,r,C,{needsBottleCalibration:y,calibration:v,name:a});document.getElementById("obsSaveBtn").onclick=async()=>{const n=Array.from(d.querySelectorAll("input[data-code]")),i=[];for(const t of n){const e=t.value;if(""===e)continue;const n=parseFloat(e);!isFinite(n)||n<0||i.push({stockItemId:o,code:t.getAttribute("data-code"),location:t.getAttribute("data-location"),value:n})}const l=m(t);if(!l||b())return g(t),g(e),T(),c.close(),void R();const u=O(o),p=Number(u?.dataset?.estimate??""),C=Number.isFinite(p)?p:0,I={stockItemId:o,name:a,division:s,unit:r,operatorId:l,operatorName:document.querySelector("#operatorStatus .tile--op .tile__name")?.textContent?.trim()||"",at:(new Date).toISOString(),observations:i,estimatedQuantityAtCapture:C};(await fetch("/stocktake/observe",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(I)})).ok?($.set(o,{...I}),q(o),_(o,I),document.getElementById("observationsSection").hidden=0===$.size,c.close()):alert("Failed to save observations.")},document.getElementById("obsCancelBtn").onclick=()=>c.close(),c.showModal()}function G(t){const e=u(t.division,t.unit),n=function(t){const e=t.observations||[];return new Set(e.map(t=>`${t.code}@${t.location||""}`))}(t),o=new Map((t.observations||[]).map(t=>[`${t.code}@${t.location||""}`,t.value])),a=[];function i(t,e){const{code:i,location:s}=d(t),r=`${i}@${s||""}`;n.has(r)?e(o.get(r)):a.push(`${function(t){const{code:e,location:n}=d(t);return"CountInLoungeBar"===e?"Count (Lounge bar)":"CountInColtBar"===e?"Count (Colt bar)":"CountInStoreRoom"===e?"Count (store room)":"CountInCellar"===e?"Count (cellar)":"OpenBottleWeightGrams"===e?n?`Total weight of open bottles (g, ${n})`:"Total weight of open bottles (g)":"KegWeightGrams"===e?"Weight of Keg in use (g)":"CountInKitchen"===e?"Count (kitchen)":e}(t)}: not observed`)}for(const t of e){const{code:e,location:n}=d(t);i(t,"CountInLoungeBar"===e?t=>a.push(`${t} in Lounge bar`):"CountInColtBar"===e?t=>a.push(`${t} in Colt bar`):"CountInStoreRoom"===e?t=>a.push(`${t} in store room`):"CountInCellar"===e?t=>a.push(`${t} in cellar`):"OpenBottleWeightGrams"===e?t=>a.push(`${t} g open bottle (${n})`):"KegWeightGrams"===e?t=>a.push(`${t} g keg weight`):"CountInKitchen"===e?t=>a.push(`${t} in kitchen`):t=>a.push(`${e}${n?` @ ${n}`:""}: ${t}`))}return a.join("; ")}function q(t){const e=document.getElementById("obsTbody"),n=$.get(t);if(!n)return;const o=n.at?function(t){const e=new Date(t);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}(n.at):"",a=W(n),i=`${0===a?"Complete":`Incomplete: ${a} remaining`} — ${G(n)}`;let s=e.querySelector(`tr[data-id='${t}']`);s?(s.children[0].textContent=o,s.children[1].textContent=n.operatorName||"",s.querySelector(".cell--obs").textContent=i):(s=document.createElement("tr"),s.dataset.id=String(t),s.innerHTML=`<td>${h(o)}</td>\n                 <td>${h(n.operatorName||"")}</td>\n                 <td class="cell--product">${h(n.name)}</td>\n                 <td class="cell--obs">${h(i)}</td>\n                 <td>\n                    <button type="button" class="btn-icon js-edit" title="Edit"><i class="bi bi-pencil-square"></i></button>\n                    <button type="button" class="btn-icon text-danger js-remove" title="Remove"><i class="bi bi-trash"></i></button>\n                 </td>`,e.appendChild(s)),s.querySelector(".js-edit").onclick=()=>{K(n.stockItemId,n.name,n.division,n.unit)},s.querySelector(".js-remove").onclick=async()=>{const t=await fetch(((t,e)=>`/stocktake/observe/${t}?division=${encodeURIComponent(e)}`)(n.stockItemId,n.division),{method:"DELETE"});if(!t.ok)return void alert("Failed to remove.");$.delete(n.stockItemId),s.remove();const e=O(n.stockItemId);e&&(e.classList.remove("tile--partial","tile--complete"),e.querySelector(".tile__badge")?.remove()),document.getElementById("observationsSection").hidden=0===$.size}}var D;D=async()=>{Array.from(document.querySelectorAll("#operatorTiles .tile")).forEach(e=>{e.addEventListener("click",async()=>{const n=e.dataset.opid,o=new FormData;o.append("id",n),(await fetch("/stocktake/select-operator",{method:"POST",body:o})).ok&&(p(t,n,365),I(),document.getElementById("operatorModal").close(),T())})}),T(),function(){setInterval(()=>{if(m(t)&&b()){g(t),g(e),T();const n=document.getElementById("obsModal");n?.open&&n.close(),R()}},15e3);const n=()=>{m(t)&&I()};document.addEventListener("click",n,{capture:!0}),document.addEventListener("keydown",n,{capture:!0}),document.addEventListener("pointerdown",n,{capture:!0})}(),await async function(){if(window.signalR&&window.signalR.HubConnectionBuilder){L=(new signalR.HubConnectionBuilder).withUrl("/hubs/stocktake").withAutomaticReconnect().build(),L.on("OperatorSelected",e=>{const n=e.colorHex||"#cccccc",o=document.getElementById("operatorStatus");o.innerHTML=`<div class="tile tile--op" style="background:${n};"><span class="tile__name">${h(e.name)}</span></div>`,o.querySelector(".tile--op").addEventListener("click",R),p(t,e.id,365),I()}),L.on("ObservationUpserted",t=>{if(B&&t.division===B.division){if(0===(t.observations?.length??0)){$.delete(t.stockItemId),document.querySelector(`#obsTbody tr[data-id='${t.stockItemId}']`)?.remove();const e=O(t.stockItemId);e&&(e.classList.remove("tile--partial","tile--complete"),e.querySelector(".tile__badge")?.remove())}else $.set(t.stockItemId,t),q(t.stockItemId),_(t.stockItemId,t);document.getElementById("observationsSection").hidden=0===$.size}}),L.on("ObservationRemoved",({stockItemId:t,division:e})=>{if(!B||e!==B.division)return;$.delete(t);const n=document.querySelector(`#obsTbody tr[data-id='${t}']`);n&&n.remove();const o=O(t);o&&(o.classList.remove("tile--partial","tile--complete"),o.querySelector(".tile__badge")?.remove()),document.getElementById("observationsSection").hidden=0===$.size});try{await L.start()}catch{}}}(),await async function(){try{const t=await fetch("/stocktake/config",{headers:{accept:"application/json"}});if(t.ok){const e=await t.json();n=!!e.showEstimatedInDialog}}catch{}}();const o=function(t){if(null===t)return null;if(""===t)return!0;const e=String(t).trim().toLowerCase();return!!["1","true","yes","on"].includes(e)||!["0","false","no","off"].includes(e)&&null}(v("showEstimates"));null!==o&&(n=o),y=await async function(){const t=await fetch("/stocktake/products",{headers:{accept:"application/json"}});return t.ok?await t.json():[]}();const a=s(v("bev")),i=s(v("kit")),u=s(v("count"));let d,C;null!==a||null!==i?(d=a??2,C=i??2):null!==u?(d=Math.ceil(u/2),C=Math.floor(u/2)):(d=2,C=2);const S=null!==v("alldivisions"),E=S?y:[...r(y,c,d,"bev"),...r(y,l,C,"kit")],k=document.getElementById("divisionTiles");if(!S){const t=document.createElement("div");t.className="muted",t.style.marginBottom=".5rem",t.textContent="Select a product division to get started.",k.parentElement.insertBefore(t,k)}!function(t){const e=document.getElementById("divisionTiles");e.innerHTML="";const n=[...t].map(t=>({...t,_avg:N(t.products)})).sort((t,e)=>e._avg-t._avg);for(const t of n){const n=document.createElement("div");n.className=`tile cat-${f(t.division)}`,n.dataset.division=t.division;const o=null==t._avg?"no history":`${t._avg} days`;n.innerHTML=`<div class="tile__name">${h(t.division)}</div><small class="tile__division">${o}</small>`,n.addEventListener("click",()=>M(t)),e.appendChild(n)}}(E),m(t)&&I()},"loading"!==document.readyState?D():document.addEventListener("DOMContentLoaded",D)})();