function prepareCategoryGroupBreakdownChart(e,r,a){var t=[...new Set(r.flatMap(e=>e.categoryGroupBreakdown?Object.keys(e.categoryGroupBreakdown):[]))],a=[...a||[]];let o={},n=(t.forEach(t=>{var e=r.reduce((e,a)=>e+(a.categoryGroupBreakdown?.[t]||0),0);o[t]=e/r.length}),t.sort((e,a)=>o[e]-o[a]||e.localeCompare(a)),{}),i=(t.forEach(a=>{n[a]=r.map(e=>e.categoryGroupBreakdown?.[a]||0)}),assignCategoryColors(t));t=t.map(e=>({label:e,data:n[e],backgroundColor:i[e]+"55",borderColor:i[e],fill:"origin",pointRadius:0,borderWidth:1})),e=new Chart(document.getElementById("categoryGroupBreakdownChart"),{type:"line",data:{labels:e,datasets:t},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"},annotation:{annotations:a}},scales:{x:{title:{display:!0,text:"Date"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Members"}}}}});__charts.push(e)}function prepareCategoryBreakdownChart(e,a,t,r){a=a.map(e=>({label:e,data:t[e],borderColor:r[e],backgroundColor:r[e]+"55",borderWidth:2,pointRadius:0,fill:"-1"}));new Chart(document.getElementById("categoryBreakdownChart"),{type:"line",data:{labels:e,datasets:a},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"},datalabels:{align:"center",anchor:"center",color:"white",font:{weight:"bold",size:12},formatter:function(e,a){var t=a.dataset.data;return a.dataIndex===Math.floor(t.length/2)?a.dataset.label:""}}},scales:{x:{title:{display:!0,text:"Date"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Members"}}}},plugins:[ChartDataLabels]})}function prepareJoinerLeaverBarChart(e,t){var a=[...new Set(t.flatMap(e=>Object.keys(e.dailyJoinersByCategoryGroup||{}).concat(Object.keys(e.dailyLeaversByCategoryGroup||{}))))];let r={};a.forEach((e,a)=>{r[e]=getDistinctColor(a)});var o=a.map(a=>({label:"Joiners - "+a,data:t.map(e=>e.dailyJoinersByCategoryGroup?.[a]||0),backgroundColor:r[a]+"FF",stack:"joiners"})),a=a.map(a=>({label:"Leavers - "+a,data:t.map(e=>-(e.dailyLeaversByCategoryGroup?.[a]||0)),backgroundColor:r[a]+"FF",stack:"leavers"})),n=document.getElementById("dailyJoinLeaveChart"),n=new Chart(n,{type:"bar",data:{labels:e,datasets:[...o,...a]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:e=>{var a=Math.abs(e.raw);return(0<=e.raw?"Joiners":"Leavers")+` - ${e.dataset.label.split(" - ")[1]}: `+a}}}},scales:{x:{stacked:!0,title:{display:!0,text:"Date"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Joiners (+) / Leavers (−)"}}}}});__charts.push(n)}function prepareMembershipChart(e,a,t,r,o){var n=r.map((e,a)=>({value:e,index:a})).filter(e=>void 0!==e.value),n=2<=n.length?[{type:"point",xValue:e[n[0].index],yValue:n[0].value,backgroundColor:"red",radius:5,borderColor:"white",borderWidth:1},{type:"point",xValue:e[n[n.length-1].index],yValue:n[n.length-1].value,backgroundColor:"red",radius:5,borderColor:"white",borderWidth:1}]:[],o=[...o||[],...n],n=document.getElementById("membershipChart").getContext("2d"),n=new Chart(n,{type:"line",data:{labels:e,datasets:[{label:"Non-Playing Members",data:t,borderColor:"red",backgroundColor:"rgba(255, 0, 0, 0.3)",borderWidth:1,pointRadius:0,fill:!0},{label:"Playing Members",data:a,borderColor:"blue",backgroundColor:"rgba(0, 0, 255, 0.3)",borderWidth:1,pointRadius:0,fill:!0},{label:"Target Playing Members (5% Growth)",data:r,spanGaps:!1,borderColor:"green",borderDash:[5,5],borderWidth:1,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"},annotation:{annotations:o}},scales:{x:{title:{display:!0,text:"Date"}},y:{stacked:!1,beginAtZero:!0,title:{display:!0,text:"Members"}}}}});__charts.push(n)}function prepareAccRevenueChart(e,a,t,r){var e=e.filter(e=>{e=new Date(e.date);return t<=e&&e<=r}),o=e.map(e=>new Date(e.date).toLocaleDateString("en-GB"));let n=0,i=0,l=0,s=0;var d=e.map(e=>n+=e.actualRevenue||0),p=e.map(e=>i+=e.targetRevenue||0),u=e.map(e=>l+=e.billedRevenue||0),e=e.map(e=>s+=e.receivedRevenue||0),o=new Chart(document.getElementById("accRevenueVsBudgetChart"),{type:"line",data:{labels:o,datasets:[{label:"Actual Revenue (�)",data:d,borderColor:"blue",backgroundColor:"rgba(0, 0, 255, 0.1)",fill:!1,tension:.2,pointRadius:0},{label:"Target Revenue (�)",data:p,borderColor:"green",borderDash:[4,4],backgroundColor:"rgba(0, 128, 0, 0.1)",fill:!1,tension:.2,pointRadius:0},{label:"Billed (�)",data:u,borderColor:"purple",backgroundColor:"rgba(128,0,128,.1)",tension:.2,pointRadius:0,fill:!1},{label:"Received (�)",data:e,borderColor:"orange",backgroundColor:"rgba(255,165,0,.1)",tension:.2,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"},annotation:{annotations:a}},scales:{x:{title:{display:!0,text:"Date"},ticks:{callback:function(e,a,t){return this.getLabelForValue(e)}}},y:{beginAtZero:!0,title:{display:!0,text:"� Revenue per Day"}}}}});__charts.push(o)}function prepareWaitingListChart(e,a,t,r){let o=a.filter(e=>{e=new Date(e.date);return t<=e&&e<=r});var a=o.map(e=>new Date(e.date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})),n=[...new Set(o.flatMap(e=>e.waitingListCategoryBreakdown?Object.keys(e.waitingListCategoryBreakdown):[]))];let i={},l=(n.forEach(a=>{i[a]=o.map(e=>e.waitingListCategoryBreakdown?.[a]||0)}),assignCategoryColors(n));n=n.map(e=>({label:e,data:i[e],backgroundColor:l[e]})),a=new Chart(document.getElementById("waitingListChart"),{type:"bar",data:{labels:a,datasets:n},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"}},scales:{x:{stacked:!0,title:{display:!0,text:"Date"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Members on Waiting List"}}}}});__charts.push(a)}function sortPlayingCategories(a){let r={};var e=[...new Set(a.flatMap(e=>e.playingCategoryBreakdown?Object.keys(e.playingCategoryBreakdown):[]))];return e.forEach(t=>{var e=a.reduce((e,a)=>e+(a.playingCategoryBreakdown[t]||0),0)/a.length;r[t]=e}),e.sort((e,a)=>r[e]-r[a]||e.localeCompare(a))}function assignCategoryColors(e){return e.reduce((e,a,t)=>{t=getDistinctColor(t);return e[a]=t,e},{})}function prepareRevenueChart(e,a,t,r){var e=e.filter(e=>{e=new Date(e.date);return t<=e&&e<=r}),o=e.map(e=>new Date(e.date).toLocaleDateString("en-GB")),n=e.map(e=>e.actualRevenue||0),i=e.map(e=>e.targetRevenue||0),l=e.map(e=>e.billedRevenue||0),e=e.map(e=>e.receivedRevenue||0),s=Math.min(...n,...i,...l,...e),s=Math.max(0,Math.floor(.8*s)),o=new Chart(document.getElementById("revenueVsBudgetChart"),{type:"line",data:{labels:o,datasets:[{label:"Actual Revenue (£)",data:n,borderColor:"blue",backgroundColor:"rgba(0,0,255,.10)",fill:!1,tension:.2,pointRadius:0},{label:"Target Revenue (£)",data:i,borderColor:"green",borderDash:[4,4],backgroundColor:"rgba(0,128,0,.10)",fill:!1,tension:.2,pointRadius:0},{label:"Billed (£)",data:l,borderColor:"purple",backgroundColor:"rgba(128,0,128,.10)",fill:!1,tension:.2,pointRadius:0},{label:"Received (£)",data:e,borderColor:"orange",backgroundColor:"rgba(255,165,0,.10)",fill:!1,tension:.2,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:1.7,plugins:{legend:{position:"top"},annotation:{annotations:a}},scales:{x:{title:{display:!0,text:"Date"},ticks:{callback(e){return this.getLabelForValue(e)}}},y:{title:{display:!0,text:"£ Revenue per Day"},beginAtZero:!1,min:s}}}});__charts.push(o)}function prepareStackedData(e,a){let o={};return a.forEach(e=>o[e]=[]),e.forEach((t,r)=>{a.forEach(e=>{let a=t.playingCategoryBreakdown[e]||null;null===a&&0<r&&(a=o[e][r-1]),o[e].push(a)})}),o}function getDistinctColor(e){var a=["#FF5733","#33FF57","#3357FF","#F39C12","#9B59B6","#E74C3C","#2ECC71","#3498DB","#1ABC9C","#E67E22"];return a[e%a.length]}