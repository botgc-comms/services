@* Views/Quiz/Index.cshtml *@
@model BOTGC.MemberPortal.Models.QuizGatekeeperViewModel

@{
    ViewData["Title"] = "Learning";
    Layout = "_SubpageLayout";
    ViewData["BackHref"] = "/";
    ViewData["BackLabel"] = "Back to dashboard";
}

@section PageHeader
{
    <h1 class="learning__title">Learning</h1>
    <p class="learning__subtitle">Quick rules quizzes to help build confidence on the course.</p>
}

<div class="quiz">

    @if (Model.HasInProgress && !string.IsNullOrWhiteSpace(Model.AttemptId))
    {
        <h2 class="quiz__card-title">You have a quiz in progress</h2>
        <p class="quiz__card-subtitle">
            You must finish it before starting another.
        </p>

        <ul class="qzlist pt-3">
            <li>
                <a class="qzcard qzcard--inprogress" href="/quiz/@Model.AttemptId">
                    <div class="qzcard__score qzcard__score--inprogress">
                        <div class="qzcard__score-main">@Model.CompletedQuestions <span class="qzcard__score-sub">/ @Model.TotalQuestions</span></div>
                        <div class="qzcard__score-note">@Model.Difficulty</div>
                    </div>

                    <div class="qzcard__main">
                        <div class="qzcard__title">Continue quiz</div>
                        <div class="qzcard__subtitle">
                            @Model.StartedLabel
                            @if (Model.NextQuestionNumber.HasValue)
                            {
                                <span> · Click to continue the quiz from question @Model.NextQuestionNumber</span>
                            }
                        </div>
                    </div>

                    <span class="qzcard__chev" aria-hidden="true">›</span>
                </a>
            </li>
        </ul>
    }
    else
    {
        <section class="quiz__card">
            <h2 class="quiz__card-title">Start a new quiz</h2>
            <p class="quiz__card-subtitle">Try a quick set of rules questions.</p>

            <form method="post" action="/quiz/start" class="quiz__start">
                @Html.AntiForgeryToken()
                <input type="hidden" name="QuestionCount" value="10" />
                <input type="hidden" name="PassMark" value="7" />
                <button class="quiz__cta" type="submit">Start quiz</button>
            </form>
        </section>
    }

    <section class="quiz__section pt-3">
        <h2 class="quiz__section-title">Completed quizzes</h2>

        @if (Model.Completed is null || Model.Completed.Count == 0)
        {
            <div class="quiz__empty">
                <p class="quiz__empty-title">No completed quizzes yet</p>
                <p class="quiz__empty-subtitle">Start one when you’re ready.</p>
            </div>
        }
        else
        {
            <ul class="qzlist pt-3">
                @foreach (var q in Model.Completed)
                {
                    var statusClass = q.Passed ? "qzcard--pass" : "qzcard--fail";

                    <li>
                        <a class="qzcard @statusClass" href="/quiz/completed/@q.AttemptId">
                            <div class="qzcard__score">
                                <div class="qzcard__score-main">@q.CorrectCount <span class="qzcard__score-sub">/ @q.TotalQuestions</span></div>
                            </div>

                            <div class="qzcard__main">
                                <div class="qzcard__title">Quiz complete</div>
                                <div class="qzcard__subtitle">
                                    @q.FinishedAtUtc.ToLocalTime().ToString("dd MMM yyyy, HH:mm")
                                    · Pass mark @q.PassMark
                                </div>
                            </div>

                            <span class="qzcard__chev" aria-hidden="true">›</span>
                        </a>
                    </li>
                }
            </ul>
        }
    </section>
</div>
