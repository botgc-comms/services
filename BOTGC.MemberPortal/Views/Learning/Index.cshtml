@* Views/Learning/Index.cshtml *@
@model BOTGC.MemberPortal.Models.LearningIndexViewModel

@{
    ViewData["Title"] = "Learning";
    Layout = "_SubpageLayout";
    ViewData["BackHref"] = "/";
    ViewData["BackLabel"] = "Back to dashboard";

    var filter = (Context.Request.Query["filter"].ToString() ?? "mandatory").ToLowerInvariant();

    if (filter is not ("mandatory" or "optional" or "completed"))
    {
        filter = "mandatory";
    }

    var filterVm = new BOTGC.MemberPortal.Models.FilterBarViewModel
    {
        AriaLabel = "Learning pack filters",
        CurrentValue = filter,
        Options = new()
        {
            new() { Value = "mandatory", Label = "Required", Href = "/learning?filter=mandatory" },
            new() { Value = "optional", Label = "Extra", Href = "/learning?filter=optional" },
            new() { Value = "completed", Label = "Completed", Href = "/learning?filter=completed" },
        }
    };

    var packs = Model.Packs ?? new List<BOTGC.MemberPortal.Models.LearningPackListItemViewModel>();

    packs = filter switch
    {
        "optional" => packs.Where(x => !x.IsMandatory).ToList(),
        "completed" => packs.Where(x => x.IsCompleted).ToList(),
        _ => packs.Where(x => x.IsMandatory).ToList(),
    };
}

@section PageHeader
{
    <h1 class="learning__title">Parent learning</h1>
    <p class="learning__subtitle">Short, practical guides to help you support your junior on the course.</p>
}

<div class="learning">

    @if (packs.Count == 0)
    {
        <div class="learning__empty">
            <p class="learning__empty-title">No packs to show</p>
            <p class="learning__empty-subtitle">Try a different filter.</p>
        </div>
    }
    else
    {
        @await Html.PartialAsync("_FilterBar", filterVm)

        <ul class="lplist">
            @foreach (var p in packs)
            {
                var statusClass = p.IsCompleted ? "lpcard--complete" : (p.IsVisited ? "lpcard--started" : "");
                var reqMark = p.IsMandatory ? "lpcard__mark--required" : "lpcard__mark--extra";
                var reqLabel = p.IsMandatory ? "Required" : "Extra";

                <li>
                    <a class="lpcard @statusClass" href="/learning/@p.PackId">
                        <div class="lpcard__meta">
                            <div class="lpcard__minutes">
                                <span class="lpcard__minutes-main">@p.EstimatedMinutes</span>
                                <span class="lpcard__minutes-sub">min</span>
                            </div>

                            @* <div class="lpcard__mark @reqMark" aria-label="@reqLabel"></div> *@
                        </div>

                        <div class="lpcard__main">
                            <div class="lpcard__title">@p.Title</div>
                            <div class="lpcard__subtitle">
                                @p.Summary
                            </div>
                        </div>

                        <span class="lpcard__chev" aria-hidden="true">›</span>
                    </a>
                </li>
            }
        </ul>
    }
</div>
